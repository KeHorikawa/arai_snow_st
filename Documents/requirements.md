# 要件定義書  
## 妙高市 降雪・積雪データ可視化Webアプリ（Streamlit）

---

## 1. 目的
新潟県妙高市の「雪情報ホームページ」に掲載されている  
**月別の降雪量・積雪量（表形式）**を取得し、  
**Python + Streamlit** により **グラフ表示**するWebアプリを作成する。

- 降雪量：折れ線グラフ
- 積雪量：棒グラフ
- 同一グラフ上に重ねて表示する

---

## 2. 対象ユーザー
- 妙高市周辺の積雪状況を把握したい利用者
- 冬季の降雪・積雪の「日別推移」を視覚的に確認したい人
- データ可視化やStreamlitアプリの学習目的の利用者

---

## 3. 対象データ（データソース）

### 3.1 対象ページ
- 妙高市の雪情報ホームページ（月別ページ）
- 月ごとにHTMLの表形式で掲載されている

雪データを取得する対象年月リスト
- 妙高市の積雪　URL
https://www.city.myoko.niigata.jp/life-info/snow-info/snow/

- 取得するデータの年月
令和1年度 降積雪観測(R1.1)
令和1年度 降積雪観測(R1.2)
令和1年度 降積雪観測(R1.3)
令和1年度 降積雪観測(R1.4)
令和1年度 降積雪観測(R1.11)
令和1年度 降積雪観測(R1.12)
令和2年度 降積雪観測(R2.1)
令和2年度 降積雪観測(R2.2)
令和2年度 降積雪観測(R2.3)
令和2年度 降積雪観測(R2.4)
令和2年度 降積雪観測(R1.11)
令和2年度 降積雪観測(R1.12)
令和3年度 降積雪観測(R3.1)
令和3年度 降積雪観測(R3.2)
令和3年度 降積雪観測(R3.3)
令和3年度 降積雪観測(R3.4)
令和3年度 降積雪観測(R3.11)
令和3年度 降積雪観測(R3.12)
令和4年度 降積雪観測(R4.1)
令和4年度 降積雪観測(R4.2)
令和4年度 降積雪観測(R4.3)
令和4年度 降積雪観測(R4.4)
令和4年度 降積雪観測(R4.11)
令和4年度 降積雪観測(R4.12)
令和5年度 降積雪観測(R5.1)
令和5年度 降積雪観測(R5.2)
令和5年度 降積雪観測(R5.3)
令和5年度 降積雪観測(R5.4)
令和5年度 降積雪観測(R5.11)
令和5年度 降積雪観測(R5.12)
令和6年度 降積雪観測(R6.1)
令和6年度 降積雪観測(R6.2)
令和6年度 降積雪観測(R6.3)
令和6年度 降積雪観測(R6.4)
令和6年度 降積雪観測(R6.11)
令和6年度 降積雪観測(R6.12)
令和7年度 降積雪観測(R7.1)
令和7年度 降積雪観測(R7.2)
令和7年度 降積雪観測(R7.3)
令和7年度 降積雪観測(R7.4)
令和7年度 降積雪観測(R7.11)
令和7年度 降積雪観測(R7.12)
令和8年度 降積雪観測(R8.11)


### 3.2 観測地点（固定：3地点）
- 新井消防署
- 頸南消防署
- 妙高市役所 妙高支所

### 3.3 取得項目
各日付について、以下の2項目を取得する。

- 降雪量（観測日の前日分）
- 積雪量（観測日当日分）
- 観測時刻：9時

※ 表中の「-」は欠測値として扱う

### 3.4 URL提供方法
- 年月ごとのページURLは **CSVファイルで提供**される
- アプリはこのCSVを参照して対象URLを取得する

---

## 4. スコープ

### 4.1 実施範囲（やること）
- HTMLページから表データを取得・解析する
- データを構造化（DataFrame化）する
- 年・月・地点を選択できるUIを提供する
- 最大3条件分のグラフを縦に並べて表示する
- データが存在しない月へのエラー対応を行う

### 4.2 対象外（やらないこと）
- ユーザー登録・ログイン機能
- データベースへの永続保存
- 積雪予測や統計分析
- 管理画面の提供

---

## 5. 画面要件（UI）

### 5.1 画面構成
- 1画面構成（Streamlit）
- 左：サイドバー（条件選択）
- 右：メイン表示エリア（グラフ・メッセージ）

### 5.2 サイドバー入力項目
ユーザーは **最大3件** の表示条件を指定できる。

#### 1条件あたりの入力
- 年
- 月
- 観測地点（3地点から選択）

#### デフォルト表示
- アプリ起動時は「最新データが存在する月」の  
  3地点分のグラフを表示する
- 当月にデータが存在しない場合は  
  「当月のデータはありません」と表示する

### 5.3 メイン表示
- 最大3つのグラフを縦方向に並べて表示
- グラフタイトル例  
  - `2025年12月 / 新井消防署`

---

## 6. グラフ要件

### 6.1 軸設定
- 横軸：日付（1〜31）
- 縦軸：降雪量・積雪量（cm）

### 6.2 表示形式
- 降雪量：折れ線グラフ
- 積雪量：棒グラフ
- 同一グラフ内で重ねて表示する

### 6.3 欠測値の扱い
- 「-」は欠測値（NaN）として処理
- グラフ上では非表示（線が途切れる／棒が表示されない）

---

## 7. データ取得・加工要件

### 7.1 HTML解析
- 指定URLへアクセスしHTMLを取得
- 表（table要素）を抽出
- 行・列構造を解析してデータ化する

### 7.2 内部データ形式（推奨）
縦持ち（tidyデータ）で保持する。

| year | month | day | location | snowfall_cm | snowdepth_cm |
|------|-------|-----|----------|-------------|--------------|

- location は日本語名称をそのまま使用
- 欠測値は NaN とする

### 7.3 キャッシュ
- 同一URLへの連続アクセスを避けるため  
  Streamlitのキャッシュ機能を利用する

---

## 8. エラー処理要件

### 8.1 データが存在しない月
- 夏季など、データが存在しない場合：
  - 「この月のデータはありません」と表示
  - グラフは表示しない

### 8.2 ページ取得失敗
- 通信エラー、HTML構造変更などの場合：
  - ユーザー向けに簡潔なエラーメッセージを表示
  - ログには詳細を出力する

### 8.3 入力不整合
- 同一条件を複数選択した場合：
  - 警告表示のみ（処理は継続）

---

## 9. 非機能要件

### 9.1 実行環境
- Python 3.10 以上
- Streamlit

### 9.2 使用ライブラリ（想定）
- requests または httpx
- pandas
- BeautifulSoup または lxml
- Plotly（推奨）または matplotlib

### 9.3 性能
- 初回表示：数秒以内
- キャッシュ後：即時表示に近い体感

---

## 10. 成果物
- Streamlitアプリ（app.py）
- URL一覧CSVファイル
- requirements.txt
- README（使い方・注意点）
- gitignore

---

## 11. 受入条件
1. 年・月・地点を最大3件選択できる
2. 選択条件ごとにグラフが縦に並ぶ
3. 降雪・積雪が指定形式で表示される
4. 欠測値があってもエラーにならない
5. データがない月で適切なメッセージが出る

---

## 12. 補足（実装時に決める事項）
- URL一覧CSVの列定義
- 「最新月」の判定方法
- グラフ描画ライブラリの最終選定
