【動作確認中です。（正しく動きません）】

# 妙高市 降雪・積雪データ可視化アプリ

新潟県妙高市の雪情報ホームページから降雪量・積雪量データを取得し、グラフで可視化するStreamlitアプリケーションです。

## 概要

このアプリは、妙高市が公開している月別の降雪・積雪データを取得し、視覚的に分かりやすいグラフで表示します。

### 主な機能

- **データ取得**: 妙高市の公式ホームページから自動でデータを取得
- **グラフ表示**: 降雪量（折れ線グラフ）と積雪量（棒グラフ）を同一グラフに表示
- **条件選択**: 年・月・観測地点を最大3件まで選択可能
- **自動キャッシュ**: 同一データへの繰り返しアクセスを削減

### 対象観測地点

1. 新井消防署
2. 頸南消防署
3. 妙高市役所 妙高支所

### 対象期間

令和1年度（2019年）から令和8年度（2026年）までの冬季データ
- 対象月: 11月、12月、1月、2月、3月、4月

## セットアップ

### 必要要件

- Python 3.10 以上
- インターネット接続（データ取得時）

### インストール

1. リポジトリをクローン

```bash
git clone <repository-url>
cd arai_snow_st
```

2. 必要なパッケージをインストール

```bash
pip install -r requirements.txt
```

## 使い方

### アプリの起動

```bash
streamlit run main.py
```

ブラウザが自動的に開き、アプリが表示されます。
通常は `http://localhost:8501` でアクセスできます。

### 操作方法

1. **サイドバーで条件を選択**
   - 年を選択
   - 月を選択（選択した年で利用可能な月のみ表示）
   - 観測地点を選択
   - 最大3件まで条件を設定可能

2. **グラフを確認**
   - 選択した条件に応じて、グラフが縦に並んで表示されます
   - 青色の棒グラフ: 積雪量（cm）
   - 赤色の折れ線グラフ: 降雪量（cm）

3. **デフォルト表示**
   - アプリ起動時は、最新データが存在する月の3地点分のグラフを自動表示

### データについて

- **観測時刻**: 9時
- **降雪量**: 前日からの降雪量
- **積雪量**: 観測日当日の積雪量
- **欠測値**: データがない日は「-」で表示され、グラフ上では非表示

## ファイル構成

```
arai_snow_st/
├── main.py              # メインアプリケーション
├── data_urls.csv        # データ取得先URL一覧
├── requirements.txt     # 依存パッケージ
├── README.md           # このファイル
└── .gitignore          # Git除外設定
```

## トラブルシューティング

### データが表示されない

- インターネット接続を確認してください
- 妙高市のウェブサイトが正常に動作しているか確認してください
- 選択した年月にデータが存在するか確認してください（夏季はデータなし）

### エラーメッセージが表示される

- `data_urls.csv` ファイルが存在し、正しい形式であることを確認してください
- 必要なパッケージがすべてインストールされているか確認してください

```bash
pip install -r requirements.txt
```

### HTML構造の変更について

妙高市のウェブサイトのHTML構造が変更された場合、データ取得が失敗する可能性があります。
その場合は `fetch_snow_data()` 関数の修正が必要です。

## 技術スタック

- **Python 3.10+**: プログラミング言語
- **Streamlit**: Webアプリフレームワーク
- **Pandas**: データ処理
- **Plotly**: グラフ描画
- **BeautifulSoup4**: HTML解析
- **Requests**: HTTP通信

## ライセンス

このプロジェクトは教育・学習目的で作成されています。

## データ出典

[妙高市 雪情報ホームページ](https://www.city.myoko.niigata.jp/life-info/snow-info/snow/)

## 注意事項

- このアプリは妙高市の公式アプリではありません
- データは妙高市のウェブサイトから取得しており、市のサーバーに負荷をかけないようキャッシュ機能を実装しています
- 商用利用する場合は、妙高市に確認してください
- データの正確性については、公式サイトで確認することを推奨します

## 開発者向け情報

### データ構造

内部では以下の形式（tidyデータ）でデータを保持しています：

| year | month | day | location | snowfall_cm | snowdepth_cm |
|------|-------|-----|----------|-------------|--------------|
| 2024 | 12    | 1   | 新井消防署 | 10.0        | 50.0         |

### キャッシュの削除

キャッシュをクリアしたい場合：

```bash
streamlit cache clear
```

または、アプリ画面右上のメニューから「Clear cache」を選択してください。

## 今後の拡張案

- [ ] 年間推移グラフの追加
- [ ] 複数年の比較機能
- [ ] CSVダウンロード機能
- [ ] 統計情報の表示（平均、最大、最小など）
- [ ] 地点間の比較グラフ

